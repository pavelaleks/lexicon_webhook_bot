import asyncio
import logging
import os

from aiohttp import web
from aiogram import Bot, Dispatcher, F
from aiogram.enums import ParseMode
from aiogram.types import (
    Message, CallbackQuery, FSInputFile, BotCommand,
    InlineKeyboardMarkup, InlineKeyboardButton
)
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.webhook.aiohttp_server import SimpleRequestHandler, setup_application
from dotenv import load_dotenv
from aiogram.client.default import DefaultBotProperties

from keyboards import (
    forward_kb, start_options_kb, courses_kb,
    course_summer_kb, course_russian_kb, course_exams_kb
)

load_dotenv()
TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = int(os.getenv("ADMIN_ID"))
WEBHOOK_URL = os.getenv("WEBHOOK_URL")
PORT = int(os.getenv("PORT", 8080))

bot = Bot(token=TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
dp = Dispatcher(storage=MemoryStorage())

@dp.message(F.text == "/start")
async def start_handler(message: Message):
    photo = FSInputFile("lesha.jpg")
    await message.answer_photo(
        photo=photo,
        caption="<b>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</b>\n\n"
                "–ú–µ–Ω—è –∑–æ–≤—É—Ç –õ—ë—à–∞ –ë—É–∫–æ–≤–∫–∏–Ω ‚Äî —è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –°—Ç—É–¥–∏–∏ ¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª!\n"
                "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–í–ø–µ—Ä—ë–¥¬ª, –∏ —è —Ä–∞—Å—Å–∫–∞–∂—É, —á–µ–º –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω.",
        reply_markup=forward_kb
    )

@dp.callback_query(F.data == "start_more")
async def continue_start(callback: CallbackQuery):
    await callback.answer()
    await callback.message.answer(
        "<b>–ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å:</b>\n\n"
        "‚Ä¢ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –Ω–∞—à–∏—Ö –∫—É—Ä—Å–∞—Ö –∏ –∫—Ä—É–∂–∫–∞—Ö\n"
        "‚Ä¢ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å –≤–∞—Å —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º —Å—Ç—É–¥–∏–∏\n"
        "‚Ä¢ –ø–µ—Ä–µ–¥–∞—Ç—å –≤–∞—à –≤–æ–ø—Ä–æ—Å –ü–∞–≤–ª—É –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á—É –ê–ª–µ–∫—Å–µ–µ–≤—É\n\n"
        "üëá –í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:",
        reply_markup=start_options_kb
    )

@dp.callback_query(F.data == "about_director")
async def about_director(callback: CallbackQuery):
    await callback.answer()
    photo = FSInputFile("alekseev-2.jpg")
    await callback.message.answer_photo(
        photo=photo,
        caption="<b>–ü–∞–≤–µ–ª –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á –ê–ª–µ–∫—Å–µ–µ–≤</b> ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä, —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Å—Ç—É–¥–∏–∏ ¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ì–ê–ì–£.\n\n"
                "üìö –î–æ–∫—Ç–æ—Ä —Ñ–∏–ª–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –Ω–∞—É–∫, –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã, –∞–≤—Ç–æ—Ä –∫—É—Ä—Å–æ–≤ –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É –∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ.\n\n"
                "–ù–∏–∂–µ ‚Äî —Å—Å—ã–ª–∫–∏, –≥–¥–µ –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ:",
        reply_markup=InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üåê –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å–∞–π—Ç", url="https://palekseev.ru")],
            [InlineKeyboardButton(text="üèõ –ù–∞ —Å–∞–π—Ç–µ –ì–ê–ì–£", url="https://www.gasu.ru/university/faculty_and_staff/2296/")],
            [InlineKeyboardButton(text="‚¨Ö –ù–∞–∑–∞–¥", callback_data="start_more")]
        ])
    )

@dp.callback_query(F.data == "show_courses")
@dp.message(F.text == "/courses")
async def show_courses(event: CallbackQuery | Message):
    if isinstance(event, CallbackQuery):
        await event.answer()
        msg = event.message
    else:
        msg = event
    await msg.answer("<b>–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –∫—É—Ä—Å:</b>", reply_markup=courses_kb)

@dp.callback_query(F.data == "course_summer")
async def show_course_summer(callback: CallbackQuery):
    await callback.answer()
    await callback.message.answer(
        "<b>üåû –õ–µ—Ç–Ω—è—è —è–∑—ã–∫–æ–≤–∞—è —à–∫–æ–ª–∞ ¬´–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è —Å –õ—ë—à–µ–π –ë—É–∫–æ–≤–∫–∏–Ω—ã–º¬ª</b>\n\n"
        "üìÖ <b>–î–∞—Ç—ã:</b> 1‚Äì14 –∏—é–Ω—è 2025\n"
        "üëßüë¶ <b>–í–æ–∑—Ä–∞—Å—Ç:</b> —É—á–µ–Ω–∏–∫–∏ 1‚Äì3 –∫–ª–∞—Å—Å–æ–≤\n"
        "üë• <b>–§–æ—Ä–º–∞—Ç:</b> –∑–∞–Ω—è—Ç–∏—è –ø–æ 2 —á. –≤ –¥–µ–Ω—å –≤ –º–∏–Ω–∏-–≥—Ä—É–ø–ø–∞—Ö (–¥–æ 4 —á–µ–ª–æ–≤–µ–∫)\n"
        "üìç <b>–ú–µ—Å—Ç–æ:</b> –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫, —Å—Ç—É–¥–∏—è ¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª\n"
        "üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> 6000 —Ä—É–±–ª–µ–π\n\n"
        "üí° <b>–ö–æ–º—É –ø–æ–¥–æ–π–¥—ë—Ç –∫—É—Ä—Å:</b>\n"
        "‚Ä¢ —Ç–µ–º, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–¥—Ç—è–Ω—É—Ç—å —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –≤ –Ω–µ–ø—Ä–∏–Ω—É–∂–¥—ë–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ\n"
        "‚Ä¢ –¥–µ—Ç—è–º, –∫–æ—Ç–æ—Ä—ã–µ –ª—é–±—è—Ç –∏—Å—Ç–æ—Ä–∏–∏, –∑–∞–≥–∞–¥–∫–∏, –∏–≥—Ä—ã —Å–æ —Å–ª–æ–≤–∞–º–∏\n"
        "‚Ä¢ —Ç–µ–º, –∫—Ç–æ —É—Å—Ç–∞–ª –æ—Ç —É—á–µ–±–Ω–∏–∫–æ–≤, –Ω–æ —Ö–æ—á–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –ª–µ—Ç–æ–º\n\n"
        "üîé <b>–ü—Ä–æ–≥—Ä–∞–º–º–∞:</b>\n"
        "‚Ä¢ —è–∑—ã–∫–æ–≤—ã–µ –∫–≤–µ—Å—Ç—ã –∏ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–≥—Ä—ã\n"
        "‚Ä¢ —á—Ç–µ–Ω–∏–µ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤\n"
        "‚Ä¢ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è, –ø–∏—Å—å–º–∞ –∏ —Å–æ—á–∏–Ω–µ–Ω–∏—è\n"
        "‚Ä¢ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ä–µ—á–∏, –ø–∞–º—è—Ç–∏, –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è\n\n"
        "üí¨ –≠—Ç–æ –∫—É—Ä—Å, –≥–¥–µ –¥–µ—Ç–∏ –Ω–µ —Ç–æ–ª—å–∫–æ —É—á–∞—Ç—Å—è, –Ω–æ –∏ –æ—Ç–¥—ã—Ö–∞—é—Ç —Å –ø–æ–ª—å–∑–æ–π ‚Äî –≤–µ—Å–µ–ª–æ, –¥—Ä—É–∂–Ω–æ, –≤ —è–∑—ã–∫–æ–≤–æ–π —Å—Ä–µ–¥–µ.\n\n"
        "üìù –û—Å—Ç–∞–ª–æ—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç!\n"
        "‚úâ –ß—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.",
        reply_markup=course_summer_kb
    )

@dp.callback_query(F.data == "course_russian")
async def show_course_russian(callback: CallbackQuery):
    await callback.answer()
    await callback.message.answer(
        "<b>üìò –ö—É—Ä—Å ¬´–†—É—Å—Å–∫–∏–π –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!¬ª</b>\n\n"
        "üéí <b>–ö–ª–∞—Å—Å—ã:</b> 4‚Äì8\n"
        "üìÖ <b>–°—Ç–∞—Ä—Ç:</b> —Å 1 –∞–≤–≥—É—Å—Ç–∞ 2025 –≥–æ–¥–∞ (–Ω–∞ –≤–µ—Å—å —É—á–µ–±–Ω—ã–π –≥–æ–¥)\n"
        "üïí <b>–ó–∞–Ω—è—Ç–∏—è:</b> 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é –ø–æ 60 –º–∏–Ω—É—Ç\n"
        "üë• <b>–§–æ—Ä–º–∞—Ç:</b> –º–∏–Ω–∏-–≥—Ä—É–ø–ø—ã –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è\n"
        "üìç <b>–ú–µ—Å—Ç–æ:</b> —Å—Ç—É–¥–∏—è ¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª, –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫\n"
        "üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> 5200 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü\n\n"
        "üí° <b>–ö–æ–º—É –ø–æ–¥–æ–π–¥—ë—Ç:</b>\n"
        "‚Ä¢ —à–∫–æ–ª—å–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–µ–Ω –ø—Ä–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É\n"
        "‚Ä¢ —Ç–µ–º, –∫—Ç–æ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –í–ü–† –∏–ª–∏ —Ö–æ—á–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ ¬´5¬ª\n"
        "‚Ä¢ –¥–µ—Ç—è–º, –∫–æ—Ç–æ—Ä—ã–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ—Å—Ç–∏ –≤ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ\n"
        "‚Ä¢ —Ç–µ–º, –∫—Ç–æ —É–∂–µ –¥—É–º–∞–µ—Ç –æ–± —É—Å–ø–µ—à–Ω–æ–π —Å–¥–∞—á–µ –û–ì–≠ –∏ –ï–ì–≠ –≤ –±—É–¥—É—â–µ–º\n\n"
        "üîç <b>–ù–∞ –∑–∞–Ω—è—Ç–∏—è—Ö:</b>\n"
        "‚Ä¢ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—é –∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏—é\n"
        "‚Ä¢ —É—á–∏–º –ø–∏—Å–∞—Ç—å –∏–∑–ª–æ–∂–µ–Ω–∏–µ, —Å–æ—á–∏–Ω–µ–Ω–∏–µ, —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ\n"
        "‚Ä¢ —Ä–∞–∑–±–∏—Ä–∞–µ–º –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–º—ã –∏ —Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏—è—Ö\n"
        "‚Ä¢ —Ä–∞–∑–≤–∏–≤–∞–µ–º —Ä–µ—á—å, —É—á–∏–º –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –º—ã—Å–ª–∏\n\n"
        "üß≠ –ö—É—Ä—Å –¥–∞—ë—Ç –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω—É—é –±–∞–∑—É –Ω–∞ –±—É–¥—É—â–µ–µ.\n\n"
        "‚úâ –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.",
        reply_markup=course_russian_kb
    )

@dp.callback_query(F.data == "course_exams")
async def show_course_exams(callback: CallbackQuery):
    await callback.answer()
    await callback.message.answer(
        "<b>üìö –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –û–ì–≠ –∏ –ï–ì–≠</b>\n\n"
        "üìÖ <b>–°—Ç–∞—Ä—Ç:</b> —Å 1 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞ (–Ω–∞ –≤–µ—Å—å —É—á–µ–±–Ω—ã–π –≥–æ–¥)\n"
        "üìò <b>–ü—Ä–µ–¥–º–µ—Ç—ã:</b> —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫, –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –∏—Å—Ç–æ—Ä–∏—è, –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ\n"
        "üïí <b>–ó–∞–Ω—è—Ç–∏—è:</b> 1‚Äì2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é –ø–æ 60‚Äì120 –º–∏–Ω—É—Ç\n"
        "üë• <b>–§–æ—Ä–º–∞—Ç:</b> –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –∏–ª–∏ –≤ –º–∏–Ω–∏-–≥—Ä—É–ø–ø–∞—Ö\n"
        "üìç <b>–ú–µ—Å—Ç–æ:</b> —Å—Ç—É–¥–∏—è ¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª (–æ—á–Ω–æ) –∏–ª–∏ –æ–Ω–ª–∞–π–Ω\n"
        "üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> –æ—Ç 4800 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞)\n\n"
        "üí° <b>–ö–æ–º—É –ø–æ–¥–æ–π–¥—ë—Ç:</b>\n"
        "‚Ä¢ –¥–µ–≤—è—Ç–∏–∫–ª–∞—Å—Å–Ω–∏–∫–∞–º –∏ –æ–¥–∏–Ω–Ω–∞–¥—Ü–∞—Ç–∏–∫–ª–∞—Å—Å–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞\n"
        "‚Ä¢ —Ç–µ–º, –∫—Ç–æ —Ö–æ—á–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ —Å–¥–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω—ã, –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—è ¬´–Ω–∞ –ø–æ—Ç–æ–º¬ª\n"
        "‚Ä¢ —É—á–µ–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–º –≤–∞–∂–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç—ã, –Ω–æ –∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–µ\n\n"
        "üîç <b>–ù–∞ –∑–∞–Ω—è—Ç–∏—è—Ö:</b>\n"
        "‚Ä¢ —Å–∏—Å—Ç–µ–º–Ω–æ —Ä–∞–∑–±–∏—Ä–∞–µ–º –≤—Å–µ —Ç–∏–ø—ã —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π\n"
        "‚Ä¢ —Ç—Ä–µ–Ω–∏—Ä—É–µ–º –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Å–æ—á–∏–Ω–µ–Ω–∏–π, —ç—Å—Å–µ –∏ —É—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤\n"
        "‚Ä¢ —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–µ\n"
        "‚Ä¢ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∞–≤—ã–∫–∏ –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç –û–ì–≠ –∏ –ï–ì–≠ (–ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è–º –§–ò–ü–ò)\n\n"
        "üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ ‚Äî –æ–ø—ã—Ç–Ω—ã–µ –ø–µ–¥–∞–≥–æ–≥–∏ –∏ —ç–∫—Å–ø–µ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è –¥–∞–∂–µ —Å —Å–∞–º—ã–º–∏ —Å–ª–æ–∂–Ω—ã–º–∏ —Ç–µ–º–∞–º–∏.\n\n"
        "‚úâ –ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ –∫–∞–∫–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è ‚Äî –∏ –º—ã –ø–æ–¥–±–µ—Ä—ë–º —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç–∏–π.",
        reply_markup=course_exams_kb
    )

@dp.callback_query(F.data == "signup_direct")
@dp.message(F.text == "/signup")
async def signup_direct(event: CallbackQuery | Message):
    if isinstance(event, CallbackQuery):
        await event.answer()
        msg = event.message
    else:
        msg = event
    await msg.answer("‚úçÔ∏è –ù–∞–ø–∏—à–∏—Ç–µ, –Ω–∞ –∫–∞–∫–æ–π –∫—É—Ä—Å —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è ‚Äî –∏ —è –ø–µ—Ä–µ–¥–∞–º —ç—Ç–æ –ü–∞–≤–ª—É –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á—É.")

@dp.callback_query(F.data == "write_direct")
@dp.message(F.text == "/write")
async def write_direct(event: CallbackQuery | Message):
    if isinstance(event, CallbackQuery):
        await event.answer()
        msg = event.message
    else:
        msg = event
    await msg.answer("üí¨ –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å ‚Äî –∏ –ü–∞–≤–µ–ª –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á –æ—Ç–≤–µ—Ç–∏—Ç –≤–∞–º –ª–∏—á–Ω–æ.")

@dp.message(F.text == "/about")
async def about_command(message: Message):
    await message.answer(
        "<b>–°—Ç—É–¥–∏—è ¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª</b>\n\n"
        "¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª ‚Äî —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É –∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤ 4‚Äì11 –∫–ª–∞—Å—Å–æ–≤.\n"
        "–ú—ã –ø—Ä–æ–≤–æ–¥–∏–º –∑–∞–Ω—è—Ç–∏—è –ø–æ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ, –≥–æ—Ç–æ–≤–∏–º –∫ <b>–û–ì–≠ –∏ –ï–ì–≠ –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É, –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ, –∏—Å—Ç–æ—Ä–∏–∏ –∏ –æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏—é</b>, —Ä–∞–∑–≤–∏–≤–∞–µ–º –ø–∏—Å—å–º–µ–Ω–Ω—É—é –∏ —É—Å—Ç–Ω—É—é —Ä–µ—á—å, "
        "–ø–æ–º–æ–≥–∞–µ–º –ø–æ–ª—é–±–∏—Ç—å —á—Ç–µ–Ω–∏–µ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –Ω–∞ —É—Ä–æ–∫–∞—Ö.\n\n"
        "üë®‚Äçüè´ –í —Å—Ç—É–¥–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ —Å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∏–º –∏ —à–∫–æ–ª—å–Ω—ã–º —Å—Ç–∞–∂–µ–º, –Ω–∞—É—á–Ω–æ–π —Å—Ç–µ–ø–µ–Ω—å—é –∏ —Å–µ—Ä—å—ë–∑–Ω—ã–º –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–º –æ–ø—ã—Ç–æ–º.\n"
        "–ó–∞–Ω—è—Ç–∏—è —Å—Ç—Ä–æ—è—Ç—Å—è –ø–æ –∞–≤—Ç–æ—Ä—Å–∫–∏–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º, —Å —É—á—ë—Ç–æ–º —É—Ä–æ–≤–Ω—è, —Ü–µ–ª–µ–π –∏ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∫–∞–∂–¥–æ–≥–æ —É—á–µ–Ω–∏–∫–∞.\n\n"
        "üìö –ß—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º:\n"
        "‚Ä¢ —É–≥–ª—É–±–ª—ë–Ω–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É –∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ\n"
        "‚Ä¢ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –∏ –≥—Ä—É–ø–ø–æ–≤—É—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –û–ì–≠ –∏ –ï–ì–≠\n"
        "‚Ä¢ –∫—É—Ä—Å—ã –¥–ª—è 4‚Äì8 –∫–ª–∞—Å—Å–æ–≤ ¬´–†—É—Å—Å–∫–∏–π –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ¬ª\n"
        "‚Ä¢ –ª–µ—Ç–Ω—é—é —è–∑—ã–∫–æ–≤—É—é —à–∫–æ–ª—É ¬´–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è —Å –õ–µ—à–µ–π –ë—É–∫–æ–≤–∫–∏–Ω—ã–º¬ª\n"
        "‚Ä¢ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∫—Ä—É–∂–∫–∏ –∏ –º–∞—Å—Ç–µ—Ä—Å–∫–∏–µ\n\n"
        "üíª –ú—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:\n"
        "–≤ —Å—Ç—É–¥–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç Telegram-–±–æ—Ç –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠ ‚Äî <b>@lexicon_punctuation_bot</b>,\n"
        "–∞ —Ç–∞–∫–∂–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ç—Ä–µ–Ω–∞–∂—ë—Ä—ã.\n\n"
        "üìç –ú—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫–µ: –ø—Ä. –ö–æ–º–º—É–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–π, 47 (–≤—Ö–æ–¥ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —É–ª. –ì–æ–ª–æ–≤–∏–Ω–∞)\n"
        "üó∫ <a href=\"https://2gis.ru/gornoaltaysk/firm/70000001093540016\">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ (2–ì–ò–°)</a>\n\n"
        "<b>¬´–õ–µ–∫—Å–∏–∫–æ–Ω¬ª ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–Ω—è—Ç–∏—è, —ç—Ç–æ —è–∑—ã–∫–æ–≤–∞—è –∫—É–ª—å—Ç—É—Ä–∞, –≤–Ω–∏–º–∞–Ω–∏–µ –∫ —É—á–µ–Ω–∏–∫—É –∏ —Å–µ—Ä—å—ë–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–±—É—á–µ–Ω–∏—é.</b>"
    )

@dp.message(F.text == "/location")
async def location_command(message: Message):
    await message.answer("üìç –ú—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –ø–æ –∞–¥—Ä–µ—Å—É: –ì–æ—Ä–Ω–æ-–ê–ª—Ç–∞–π—Å–∫, –ø—Ä. –ö–æ–º–º—É–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–π, 47", disable_web_page_preview=True)

@dp.message()
async def forward_message(message: Message):
    user = message.from_user
    text = f"<b>–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç @{user.username or '–±–µ–∑ username'}:</b>\n\n{message.text}"
    try:
        await bot.send_message(chat_id=ADMIN_ID, text=text)
        await message.answer("–°–ø–∞—Å–∏–±–æ! –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ.")
    except Exception:
        await message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ —Å–æ–æ–±—â–µ–Ω–∏—è.")

async def on_startup(app):
    await bot.set_webhook(WEBHOOK_URL)
    await bot.set_my_commands([
        BotCommand(command="start", description="üìç –°—Ç–∞—Ä—Ç"),
        BotCommand(command="courses", description="üìö –ö—É—Ä—Å—ã"),
        BotCommand(command="about", description="‚ÑπÔ∏è –û —Å—Ç—É–¥–∏–∏"),
        BotCommand(command="write", description="‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é"),
        BotCommand(command="location", description="üìç –ì–¥–µ –Ω–∞—Å –Ω–∞–π—Ç–∏"),
    ])

async def on_shutdown(app):
    await bot.delete_webhook()
    await bot.session.close()

async def create_app():
    app = web.Application()
    app.on_startup.append(on_startup)
    app.on_shutdown.append(on_shutdown)
    SimpleRequestHandler(dispatcher=dp, bot=bot).register(app, path="/webhook")
    setup_application(app, dp, bot=bot)
    return app

if __name__ == "__main__":
    logging.basicConfig(level=logging.INFO)
    web.run_app(create_app(), port=PORT)